<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Attendance</title>
  <meta name="description" content="Attendance">

  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

  <style>
    .col {
      display: inline-block;
    }
    body {
      font-size: 1.4em;
    }
    .date.ui-selecting {
      background: #FECA40;
    }
    .date.ui-selected {
      background: #F39814;
      color: white;
    }

  </style>
</head>

<body>

  <p id="feedback">
    <span>You've selected:</span> <span id="select-result">none</span>
  </p>

  <ol id="selectable">
    <li class="row">
      <ol>
        <li class="col">id1</li>
        <li class="col">name1</li>
        <li class="col date absent">date11</li>
        <li class="col date">date12</li>
        <li class="col date">date13</li>
        <li class="col date">date14</li>
        <li class="col date">date15</li>
      </ol>
    </li>
    <li class="row">
      <ol>
        <li class="col">id2</li>
        <li class="col">name2</li>
        <li class="col date">date21</li>
        <li class="col date absent">date22</li>
        <li class="col date absent">date23</li>
        <li class="col date absent">date24</li>
        <li class="col date absent">date25</li>
      </ol>
    </li>
  </ol>

  <button id="send-button">send</button>

  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

  <script>
    var selection = '';

    $(document).ready(function(){
      $("#selectable").selectable({
        stop: function() {
          selection = {};
          $( ".ui-selected", this ).each(function() {
            if (this.classList.contains("row")) {
              var children = this.children[0].children;
              var id = children[0].innerText;
              var name = children[1].innerText;
              selection[id] = { "name": name, "ranges": [] }
              for (var i = 2; i < children.length; i++) {
                var child = children[i];
                if (child.classList.contains("ui-selected")) {
                  selection[id]["ranges"].push(child.innerText);
                }
              }
            }
          });
          console.log(selection);
        }
			});
    });

    $("#send-button").click(function(e) {
      e.preventDefault();
      $.ajax({
        type: "POST",
        url: "http://127.0.0.1:8000/",
        dataType: "json",
        data: selection,
        success: function(result) {
            alert('ok');
        },
        error: function(result) {
            alert('error');
        }
      });
    });
  </script>
</body>
</html>
