<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Attendance</title>
  <meta name="description" content="Attendance">

  <link rel="stylesheet" href="./css/vis-timeline-graph2d.min.css">

  <style type="text/css">
    body {
      color: #4D4D4D;
      font: 10pt arial;
    }
  </style>
</head>

<body onresize="/*timeline.checkResize();*/">

  <div id="visualization"></div>
  <input id="save" type="button" value="save">
  <input id="load" type="button" value="load">
  <textarea id="data"></textarea>

  <script src="./js/vis-timeline-graph2d.min.js"></script>
  <script>
  
    var sampleGroups = [
      {id: 1, content: 'name1'},
      {id: 2, content: 'name2'},
      {id: 3, content: 'name3'},
      {id: 4, content: 'name4'}
    ]

    var sampleItems = [
      {
        "group": 1,
        "start": "2020-11-08",
        "end": "2020-11-13",
        "id": "1"
      },
      {
        "group": 1,
        "start": "2020-12-03",
        "end": "2020-12-12",
        "id": "2"
      },
      {
        "group": 3,
        "start": "2020-11-04",
        "end": "2020-11-12",
        "id": "3"
      },
      {
        "group": 3,
        "start": "2020-11-23",
        "end": "2020-11-30",
        "id": "4"
      },
      {
        "group": 4,
        "start": "2020-11-18",
        "end": "2020-11-24",
        "id": "5"
      }
    ]

    var groups = new vis.DataSet(sampleGroups);
    var items = new vis.DataSet(sampleItems);

    function addDays(date, days) {
      var result = new Date(date);
      result.setDate(result.getDate() + days);
      return result;
    }

    // specify options
    var options = {
      stack: true,
      editable: {
        updateGroup: false,
        updateTime: true,
        overrideItems: true,
        remove: true,
        add: true
      },
      margin: {
        item: 10, // minimal margin between items
        axis: 5   // minimal margin between items and the axis
      },
      orientation: 'top',

      timeAxis: { scale: 'day', step: 1 },
      min: new Date(2020, 10, 1),  // lower limit of visible range
      max: new Date(2020, 11, 31),

      zoomable: false,
      zoomMin: 1000 * 60 * 60 * 24 * 31 * 2,  // two days (in milliseconds)
      zoomMax: 1000 * 60 * 60 * 24 * 31 * 3,  // 3 months

      snap: function (date, scale, step) {
        var days = 1000 * 60 * 60 * 24;
        return Math.round(date / days) * days - 1000 * 60 * 60 * 2;
      },
      // onUpdate: function (item, callback) {
      //   var update = prompt('Edit items text:', item.content);
      //   if (update === null) {
      //     callback(null);
      //   } else {
      //     item.content = update;
      //     callback(item);
      //   }
      // },
      onAdd(item, callback) {
        item.end = addDays(item.start, 1);
        callback(item);
      }
    };

    // create a Timeline
    var container = document.getElementById('visualization');
    timeline = new vis.Timeline(container, null, options);
    timeline.setGroups(groups);
    timeline.setItems(items);

    var txtData = document.getElementById('data');
    var btnSave = document.getElementById('save');
    var btnLoad = document.getElementById('load');

    btnLoad.onclick = function loadData () {
      var data = JSON.parse(txtData.value);
      items.clear();
      items.add(data);
    };

    btnSave.onclick = function saveData() {
      // get the data from the DataSet
      //
      // Note that we specify the output type of the fields start and end
      // as "ISODate", which is safely serializable. Other serializable types
      // are "Number" (unix timestamp), "ASPDate" or "String" (without timezone!).
      //
      // Alternatively, it is possible to configure the DataSet to convert
      // the output automatically to ISODates like:
      //
      //   var options = {
      //     type: {start: 'ISODate', end: 'ISODate'}
      //   };
      //   var items = new vis.DataSet(options);
      //   // now items.get() will automatically convert start and end to ISO dates.
      //
      var data = items.get({
        type: {
          start: 'Number',
          end: 'Number'
        }
      });

      // serialize the data and put it in the textarea
      txtData.value = JSON.stringify(data, null, 2);
    }
  
  </script>

</body>
</html>
